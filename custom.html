<!DOCTYPE HTML>

<!--
	Citrusy: A responsive HTML5 website template by HTML5Templates.com
	Released for free under the Creative Commons Attribution 3.0 license (html5templates.com/license)
	Visit http://html5templates.com for more great templates or follow us on Twitter @HTML5T
-->

<html>
<head>
<title>Create your own processor</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="description" content="" />
<meta name="keywords" content="" />
<noscript>
<link rel="stylesheet" href="css/5grid/core.css" />
<link rel="stylesheet" href="css/5grid/core-desktop.css" />
<link rel="stylesheet" href="css/5grid/core-1200px.css" />
<link rel="stylesheet" href="css/5grid/core-noscript.css" />
<link rel="stylesheet" href="css/style.css" />
<link rel="stylesheet" href="css/style-desktop.css" />
</noscript>
<link rel="stylesheet" href="css/custom.css" />
<script src="css/5grid/jquery.js"></script>
<script src="css/5grid/init.js?use=mobile,desktop,1000px&amp;mobileUI=1&amp;mobileUI.theme=none"></script>
<!--[if IE 9]><link rel="stylesheet" href="css/style-ie9.css" /><![endif]-->
</head><body>
<div id="header-wrapper">
	<header id="header">
		<div class="5grid-layout">
			<div class="row">
				<div class="12u" id="logo"> <!-- Logo -->
					<h1><a href="#" class="mobileUI-site-name">BeepBeep</a></h1>
					<p>The event processor anyone can use</p>
				</div>
			</div>
		</div>
		<div class="5grid-layout">
			<div class="row">
				<div class="12u" id="menu">
					<nav class="mobileUI-site-nav">
						<ul>
							<li><a href="index.html">Home</a></li>
							<li class="current_page_item"><a href="quickintro.html">In 5 minutes</a></li>
							<li><a href="features.html">Features</a></li>
							<li><a href="download.html">Get BeepBeep</a></li>
							<li><a href="documentation.html">Documentation</a></li>
						</ul>
					</nav>
				</div>
			</div>
		</div>
	</header>
</div>
<div id="wrapper">
	<div id="page">
		<div class="5grid-layout">
			<div class="row">
				<div class="3u">
					<div id="sidebar2">
						<section>
							<div class="sbox1">
								<h2>In this page</h2>
								<ul class="style1">
									<li class="first"><a href="#example1">String length</a></li>
									<li><a href="#example2">Euclidean distance</a></li>
									<li><a href="#example3">Separating a point</a></li>
									<li><a href="#example4">Threshold</a></li>
									<li><a href="#example5">Stuttering</a></li>
									<li><a href="#example6">A processor with memory</a></li>
								</ul>

							</div>
						</section>
						<section>
							<div class="sbox2">
								<h2>Quick links</h2>
								<ul class="style1">
									<li class="first"><a href="why.html">Why use ESQL?</a></li>
									<li><a href="processors.html">Available processors</a></li>
									<li><a href="custom.html">Create your own processor</a></li>
									<li><a href="extend.html">Extend ESQL</a></li>
									<!-- <li><a href="#">Donec dictum metus in sapien</a></li>
									<li><a href="#">Nulla luctus eleifend purus</a></li>
									<li><a href="#">Maecenas luctus lectus at sapien</a></li> -->
								</ul>
							</div>
						</section>
					</div>
				</div>
				<div class="9u mobileUI-main-content">
					<div id="content">
						<section>
							<div class="post">
								<h2>Create your own processor</h2>

<p>What if none of the processors suits your needs? If you use Java, BeepBeep allows
you to create your own, which you can then compose with existing processors.
You can do so using <strong>no more than 4 lines of boilerplate code</strong>.
(If you're willing to write about 10 more lines, you can also
<a href="extend.html">integrate your processor into the ESQL language</a>.)</p>

<p>The simplest way to do so is to extend the <code>SingleProcessor</code>
class, which takes care of most of the "plumbing" related to event management:
connecting inputs and outputs, looking after event queues, etc. All you have
left to do is to:

<ul>
<li>Define how many input traces your processor needs, and how many output
traces it produces. These two values are called the input and output
<strong>arity</strong> the processor, respectively.</li>

<li>Write the actual computation that should occur, i.e. what output event(s)
to produce (if any), given an input event.</li>
</ul>

<p>The minimal working example for a custom processor is made of six lines of
code:</p>

<pre class="code">
import ca.uqac.lif.cep.*;

public class MyProcessor extends SingleProcessor {

  public MyProcessor() {
    super(0, 0);
  }

  public Queue&lt;Object[]&gt; compute(Object[] inputs) {
    return null;
  }
}
</pre>

<p>This results in a processor that accepts no inputs, and produces no output.
To make things more interesting, we will study a couple of examples.</p>

<a name="example1"></a><h3 class="normal">Example 1: string length</h3>

<p>As a first example, let us write a processor that receives character strings
as its input events, and that computes the length of each string. The input
arity of this processor is therefore 1 (it receives one string at a time), and
its output arity is 1 (it outputs a number). Specifying the input and output
arity is done through the call to <code>super()</code> in the processor's
constructor: the first argument is the input arity, and the second argument
is the output arity.</p>

<p>The actual functionality of our processor will be written in the body of
method <code>compute()</code>. This method is called whenever an input event is available,
and a new output event is required. Its argument is an array of Java <code>Object</code>s;
the size of that array is that of the input arity we declared for this
processor (in our case: 1). Computing the length amounts to extracting the
first (and only) event of array <code>inputs</code>, casting it to a <code>String</code>,
and getting its length. The end result is this:</p>

<pre class="code">
import ca.uqac.lif.cep.*;

public class StringLength extends SingleProcessor {

  public StringLength() {
    super(1, 1);
  }

  public Queue&lt;Object[]&gt; compute(Object[] inputs) {
    int length = ((String) inputs[0]).length();
    return Processor.wrapObject(length);
  }
}
</pre>

<p>Note that the <code>compute()</code> method must return a queue of arrays of
objects. If the processor is of arity <i>n</i>, it must put an event into each
of its <i>n</i> output traces. It may also decide to output more than one such
<i>n</i>-uplet for a single input event, and these events are accumulated into a
queue --hence the slightly odd return type. However, if our processor outputs a
single element, the tedious process of creating an array of size 1, putting the
elemetn in the array, creating a queue, putting the array into the queue and
returning the queue is encapsulated in the convenience method
<code>Processor.wrapObject()</code>, which does exactly that.</p>

<p>That's it. From then on, you can instantiate <code>StringLength</code>,
connect it to the output of any other processor that produces strings, and pipe
its result to the input of any other processor that accepts numbers.</p>

<a name="example2"></a><h3 class="normal">Example 2: Euclidean distance</h3>

<p>This second example will show an example of a processor that takes as input
two traces. The events of each trace are instances of the user-defined class
<code>Point</code>:</p>

<pre class="code">
public class Point {
  public float x;
  public float y;
}
</pre>

<p>We will write a processor that takes one event (i.e. one <code>Point</code>)
from each input trace, and return the Euclidean distance between these two
points.</p>

<pre class="code">
import ca.uqac.lif.cep.*;

public class EuclideanDistance extends SingleProcessor {

  public StringLength() {
    super(2, 1);
  }

  public Queue&lt;Object[]&gt; compute(Object[] inputs) {
    Point p1 = (Point) inputs[0];
    Point p2 = (Point) inputs[1];
    float distance = Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));
    return Processor.wrapObject(distance);
  }
}
</pre>

<a name="example3"></a><h3 class="normal">Example 3: separating a point</h3>

<p>This processor takes as input a single trace of <code>Point</code>s (see
example above), and sends the <i>x</i> and <i>y</i> component of that point
as events of two output traces. It is an example of processor with an output
arity of 2.</p>

<pre class="code">
import ca.uqac.lif.cep.*;

public class SplitPoint extends SingleProcessor {

  public SplitPoint() {
    super(1, 2);
  }

  public Queue&lt;Object[]&gt; compute(Object[] inputs) {
    Point p = (Point) inputs[0];
    float[] output_event = new float[2];
    float[0] = p.x;
    float[1] = p.y;
    return Processor.wrapVector(output_event);
  }
}
</pre>

<p>Note that we use <code>wrapVector()</code>, rather than
<code>wrapObject()</code>, as the result we are producing is already an array of
size 2. Method <code>wrapVector()</code> simply puts that array into a new empty
queue. Note also that it is an error to produce an array whose size is not equal
to the processor's output arity.</p>

<a name="example4"></a><h3 class="normal">Example 4: threshold</h3>

<p>So far, all processors we designed return one output event for every input
event (or pair of events) they receive. This needs not be the case. The
following processor outputs an event if its value is greater than 0, and
no event at all otherwise.</p>

<pre class="code">
import ca.uqac.lif.cep.*;

public class OutIfPositive extends SingleProcessor {

  public OutIfPositive() {
    super(1, 1);
  }

  public Queue&lt;Object[]&gt; compute(Object[] inputs) {
    Number n = (Number) inputs[0];
    if (n.floatValue() &gt; 0)
      return Processor.wrapObject(inputs[0]);
    else
      return null;
  }
}
</pre>

<p>The way to indicate that a processor does not produce any output for an input
is to return <code>null</code>. Note that this should not be confused with the
output arity of the processor.</p>

<a name="example5"></a><h3 class="normal">Example 5: stuttering</h3>

<p>Conversely, a processor does not need to output only one event for each input
event. For example, the following processor repeats an input event as many times
as its numerical value: if the event is the value 3, it is repeated 3 times in
the output.</p>

<pre class="code">
import ca.uqac.lif.cep.*;

public class Stuttering extends SingleProcessor {

  public Stuttering() {
    super(1, 1);
  }

  public Queue&lt;Object[]&gt; compute(Object[] inputs) {
    Number n = (Number) inputs[0];
    Queue&lt;Object[]&gt; queue = new LinkedList&lt;Object[]&gt;();
    for (int i = 0; i &lt; n.intValue(); i++) {
      queue.add(inputs);
    }
    return queue;
  }
}
</pre>

<a name="example6"></a><h3 class="normal">Example 6: a processor with memory</h3>

<p>So far, all our processors are <em>memoryless</em>: they keep no information
about past events when making their computation. It is also possible to create
"memoryful" processors. As an example, let's create a processor that outputs the
maximum between the current event and the previous one. That is, given the
following input trace:</p>

<pre>
5, 1, 2, 3, 6, 4, ...
</pre>

<p>the processor should output:</p>

<pre>
(nothing), 5, 2, 3, 6, 6, ...
</pre>

<p>Notice how, after receiving the first event, the processor should not return
anything yet, as it needs two events before saying something. Here's a possible
implementation:</p>

<pre class="code">
import ca.uqac.lif.cep.*;

public class MyMax extends SingleProcessor {

  Number last = null;

  public MyMax() {
    super(1, 1);
  }

  public Queue&lt;Object[]&gt; compute(Object[] inputs) {
    Number current = (Number) inputs[0];
    Number output;
    if (last != null) {
      output = Math.max(last, current);
      last = current;
      return Processor.wrapObject(output);
    }
    else {
      last = current;
      return null;
    }
  }
}
</pre>

							</div>
						</section>
					</div>
				</div>
				
			</div>
		</div>
	</div>
</div>
<div id="footer-wrapper">
	<div class="5grid-layout">
		<div class="row" id="footer-content">
			<div class="3u" id="box1">
				<section>
					<h2>Made at LIF</h2>
					<p><a href="#"><img src="images/logo-shadow.png" alt="LIF"/></a></p>
					<p>&nbsp;</p>
					<p>BeepBeep was developed through the research done at <a href="http://lif.uqac.ca">LIF</a>, the
					Formal Computer Science Laboratory in <a href="http://www.uqac.ca/">Université du Québec à
					Chicoutimi</a>, Canada.</p>
				</section>
			</div>
			<div class="3u" id="box2">
				<section>
					<h2>Around BeepBeep</h2>
					<ul class="style6">
						<li class="first">
							<h3>Meet the author</h3>
							<p><a href="http://leduotang.ca/sylvain">Visit the homepage of Sylvain Hallé, author of BeepBeep and recipient of numerous research awards.</a></p>
						</li>
						<li>
							<h3>Complex Event Processing</h3>
							<p><a href="https://en.wikipedia.org/wiki/Complex_event_processing">Read about CEP on Wikipedia</a></p>
						</li>
						<!--<li>
							<h3>Donec dictum metus in sapien</h3>
							<p><a href="#">Donec leo, vivamus fermentum nibh in augue praesent a lacus at urna congue rutrum.</a></p>
						</li>-->
					</ul>
				</section>
			</div>
			<div class="3u" id="box4">
				<section>
					<h2>Interested in BeepBeep?</h2>
					<p><strong>If you think BeepBeep can be useful to you, please contact us!</strong></p>
					<p>&nbsp;</p>
					<p>BeepBeep is free software, released under the <a href="https://www.gnu.org/copyleft/lesser.html">GNU LGPL</a>. This means you can include it as a library
					in any project, including closed-source commercial software.</p>
					<p>&nbsp;</p>
					<p>Also, if you are interested to contribute new features to the tool, don't hesitate to drop us a line.</p>
				</section>
			</div>
			<div class="3u" id="box3">
				<section>
					<h2>Contact Information</h2>
					<p><strong>Sylvain Hallé, Ph.D.</strong><br/>
					Associate Professor</p>
					<p><strong>Email</strong>: shalle@uqac.ca</p>
					<p>&nbsp;</p>
					<p><strong>Université du Québec à Chicoutimi</strong><br/>
					555, boul. de l'Université<br/>
					Chicoutimi, Québec<br/>
					G7H 2B1 Canada</p>
				</section>
			</div>
		</div>
	</div>
</div>
<div>
	<div class="5grid-layout" id="copyright">
		<div class="row">
			<div class="12u">
				<p>&copy; 2008-2015 Laboratoire d'informatique formelle | Design: <a href="http://html5templates.com/">HTML5Templates.com</a></p>
			</div>
		</div>
	</div>
</div>
</body>
</html>