<!DOCTYPE HTML>

<!--
	Citrusy: A responsive HTML5 website template by HTML5Templates.com
	Released for free under the Creative Commons Attribution 3.0 license (html5templates.com/license)
	Visit http://html5templates.com for more great templates or follow us on Twitter @HTML5T
-->

<html>
<head>
<title>Available processors - BeepBeep</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="description" content="" />
<meta name="keywords" content="" />
<noscript>
<link rel="stylesheet" href="css/5grid/core.css" />
<link rel="stylesheet" href="css/5grid/core-desktop.css" />
<link rel="stylesheet" href="css/5grid/core-1200px.css" />
<link rel="stylesheet" href="css/5grid/core-noscript.css" />
<link rel="stylesheet" href="css/style.css" />
<link rel="stylesheet" href="css/style-desktop.css" />
</noscript>
<link rel="stylesheet" href="css/custom.css" />
<script src="css/5grid/jquery.js"></script>
<script src="css/5grid/init.js?use=mobile,desktop,1000px&amp;mobileUI=1&amp;mobileUI.theme=none"></script>
<!--[if IE 9]><link rel="stylesheet" href="css/style-ie9.css" /><![endif]-->
</head><body>
<div id="header-wrapper">
	<header id="header">
		<div class="5grid-layout">
			<div class="row">
				<div class="12u" id="logo"> <!-- Logo -->
					<h1><a href="#" class="mobileUI-site-name">BeepBeep</a></h1>
					<p>The event processor anyone can use</p>
				</div>
			</div>
		</div>
		<div class="5grid-layout">
			<div class="row">
				<div class="12u" id="menu">
					<nav class="mobileUI-site-nav">
						<ul>
							<li><a href="index.html">Home</a></li>
							<li class="current_page_item"><a href="quickintro.html">In 5 minutes</a></li>
							<li><a href="features.html">Features</a></li>
							<li><a href="download.html">Get BeepBeep</a></li>
							<li><a href="documentation.html">Documentation</a></li>
						</ul>
					</nav>
				</div>
			</div>
		</div>
	</header>
</div>
<div id="wrapper">
	<div id="page">
		<div class="5grid-layout">
			<div class="row">
				<div class="3u">
					<div id="sidebar2">
						<section>
							<div class="sbox1">
								<h2>In this page</h2>
								<ul class="style1">
									<li class="first"><a href="#basic">Basic processors</a></li>
									<li><a href="#io">Input/output</a></li>
									<li><a href="#tuples">Handling tuples</a></li>
								</ul>

							</div>
						</section>
						<section>
							<div class="sbox2">
								<h2>Quick links</h2>
								<ul class="style1">
									<li class="first"><a href="why.html">Why use ESQL?</a></li>
									<li><a href="processors.html">Available processors</a></li>
									<li><a href="custom.html">Create your own processor</a></li>
									<li><a href="extend.html">Extend ESQL</a></li>
									<!-- <li><a href="#">Donec dictum metus in sapien</a></li>
									<li><a href="#">Nulla luctus eleifend purus</a></li>
									<li><a href="#">Maecenas luctus lectus at sapien</a></li> -->
								</ul>
							</div>
						</section>
					</div>
				</div>
				<div class="9u mobileUI-main-content">
					<div id="content">
						<section>
							<div class="post">
								<h2>Extend ESQL</h2>

<p>You know that by <a href="custom.html">creating your own processor</a>, you
can pipe it to any other existing processor, provided that its input and output
events are of compatible types. It is also possible to extend the grammar of
the ESQL language, so that you can also use your processor directly in ESQL
queries. <strong>All this in less than 10 lines of code.</strong></p>

<p>As an example, let us consider the following processor, which repeats every
input event <i>n</i> times, where <i>n</i> is a parameter decided when the
processor is instantiated. Its implementation is as follows:</p>

<pre class="code">
import ca.uqac.lif.cep.*;

public class Repeater extends SingleProcessor {

  private final int numReps;

  public Repeater(int n) {
    super(1, 1);
    this.numReps = n;
  }

  public Queue&lt;Object[]&gt; compute(Object[] inputs) {
    Queue&lt;Object[]&gt; queue = new LinkedList&lt;Object[]&gt;();
    for (int i = 0; i &lt; this.numReps; i++) {
      queue.add(inputs);
    }
    return queue;
  }
}
</pre>

<a name="rule"></a><h3>Step 1: Defining a new grammar rule</h3>

<p>We would like to be able to use this processor in ESQL queries. The first
step is to decide what syntax one shall use to invoke the processor. In order to
work, the processor requires two things: the output of another processor, and
the number of times it should repeat each event. Therefore, an intuitive syntax
for the processor could be:</p>

<p>
<code>REPEAT (</code><i>some processor</i><code>) </code><i>n</i><code> TIMES</code>
</p>

<p>In this syntax, <i>some processor</i> refers to any other ESQL expression that
builds a processor, and <i>n</i> is a number. The result of this expression
is itself another object of type <i>processor</i>.</p>

<p>If you are familiar with EBNF grammars, what follows should be easy. We must
first tell the ESQL interpreter to add to its grammar a new case for the parsing of
the <i>&lt;processor&gt;</i> rule. This rule should correspond to the parsing
of our new, <code>Repeater</code> processor. This is done as follows:</p>

<pre class="code">
Interpreter my_int = new Interpreter();
my_int.addCaseToRule("&lt;processor&gt;", "&lt;repeater&gt;");
</pre>

<p>At this point, the interpreter knows that <code>&lt;processor&gt;</code> can
be parsed as a <code>&lt;repeater&gt;</code>, but it has no idea what this case
corresponds to. We must tell the interpreter what is the parsing pattern for
<code>&lt;repeater&gt;</code>, using method <code>addRule()</code>:</p>

<pre class="code">
my_int.addRule("&lt;repeater&gt;", "REPEAT ( &lt;processor&gt; ) &lt;number&gt; TIMES");
</pre>

<p>The first argument is the name of the new rule we with to add (i.e. the left-hand
side of the BNF rule), and the second argument is the right-hand side, or parsing
pattern, corresponding to that rule. This parsing pattern is made of:</p>

<ul>
<li>The literal <code>REPEAT</code></li>
<li>An opening parenthesis</li>
<li>The <code>&lt;processor&gt;</code> rule name. This means that what follows
the parenthesis should follow the syntax of the <code>&lt;processor&gt;</code>
rule.</li>
<li>A closing parenthesis</li>
<li>The <code>&lt;number&gt;</code> rule name. This means that what follows
the parenthesis should follow the syntax of the <code>&lt;number&gt;</code>
rule (which corresponds to any character string with the format of a number).</li>
<li>The literal <code>TIMES</code></li>
</ul>

<p>That's it. From now on, the interpreter will correctly parse an expression
involving that syntax, and know that it represents an element of type
<code>&lt;processor&gt;</code>. This means that such an expression can be written
anywhere a <code>&lt;processor&gt;</code> is accepted; for example in the
following:</p>

<pre class="code">
SELECT a FROM (
  REPEAT (THE TUPLES OF FILE "foo.csv") 3 TIMES
)
</pre>

<a name="build"></a><h3>Step 2: build a processor form an expression</h3>

<p>The previous step allows the interpreter to know that <code>REPEAT xxx n TIMES</code>
corresponds to a processor, but it doesn't know what processor it actually is,
or how to instantiate it from the expression. We must therefore tell the
processor what object class corresponds to the parsing of such an expression.
This is done through the <code>addAssociation()</code> method.</p>

<pre class="code">
my_int.addAssociation("&lt;repeater&gt;", "Repeater");
</pre>

<p>The method tells the interpreter that encountering the <code>&lt;repeater&gt;</code>
rule will result in the instantiation of a Java object of the class <code>Repeater</code>.
This second argument should be the fully qualified name of the class. That is,
if <code>Repeater</code> is located in package <code>my.package</code>, then
one should write <code>my.package.Repeater</code> in the call to <code>addAssociation()</code>.</p>

<p>Upon parsing the <code>&lt;repeater&gt;</code> rule, the interpreter will
look for a method called <code>build()</code> in the corresponding class. We must
therefore provide such a method in <code>Repeater</code>. Its signature should
be the following (it it's different, or absent, the interpreter will
complain):</p>

<pre class="code">
public static void build(Stack&lt;Object&gt; stack) {

}
</pre>

<p>The task of the <code>build()</code> method is to consume elements of the
stack to build a new instance of the object to create, and to put that new
object back on the stack so that other objects can consume it during their
own construction. The contents of the stack correspond to the grammar rule we
gave the interpreter in the very beginning. In our case, this means that the
stack contains, from top to bottom:</p>

<ul>
<li>A <code>String</code> object containing the word <code>"TIMES"</code></li>
<li>A <code>Number</code> object corresponding to the actual value of <i>n</i>
  that was written in the expression</li>
<li>A <code>String</code> object containing a closing paremthesis</li>
<li>An object of class <code>ca.uqac.lif.cep.Processor</code>, which is the
  processor resulting from the parsing of the inner expression
<li>A <code>String</code> object containing an opening paremthesis</li>
<li>A <code>String</code> object containing the word <code>"REPEAT"</code></li>
</ul>

<p>Creating a new instance of <code>Repeater</code> is therefore straightforward.
One simply has to <code>pop()</code> the stack to fetch the value of <i>n</i>
and the <code>Processor</code> object to use as input, and discard all "useless"
keywords (it is important to remove them from the stack, though, otherwise
other objects accessing the stack afterwards will be confused by what they find
there). One can then instantiate a new <code>Repeater</code>, pipe the input
into it (using <code>Connector.connect()</code>), and put the resulting object
on the stack.</p>

<pre class="code">
public static void build(Stack&lt;Object&gt; stack) {
  stack.pop(); // TIMES
  Number n = (Number) stack.pop();
  stack.pop(); // )
  Processor p = (Processor) stack.pop();
  stack.pop(); // (
  stack.pop(); // REPEAT
  Repeater r = new Repeater(n.intValue());
  Connector.connect(p, r);
  stack.push(r);
}
</pre>

<p>All done! As you can see, adding a new processor to the ESQL grammar took us
3 lines of code to extend the grammar, and another 9 lines for building it from
the parse stack. (Try doing that with another software!)</p>

<a name="extension"></a><h3>Creating a grammar extension</h3>

<p>If you write a lot of extensions to the syntax (great! please tell us), it
might be a good idea to "package" these extensions so that you don't have to
manually put them into the interpreter every time. BeepBeep provides a class
that allows you to do this easily, called <code>GrammarExtension</code>.
The boilerplate code for an extension is this:</p>

<pre class="code">
public class MyGrammar extends GrammarExtension {

  public MyGrammar() {
    super(MyGrammar.class);
  }
}
</pre>

<p>As a matter of fact, you have nothing else to write. However, two text files
should be present in the same folder as your extension class:</p>

<ul>
<li>The first, called <code>eml.bnf</code>, should contain all the new BNF rules
that should be added to the interpreter</li>
<li>The second, called <code>associations.txt</code>, should contain the list
of all associations between grammar rules and objects (what you pass to the
interpreter's <code>addAssociation()</code> method)</li> 
</ul>

<p>For our grammar extension, here's what would be the contents of <code>eml.bnf</code>:</p>

<pre class="code">
&lt;processor&gt; := &lt;repeater&gt; ;
&lt;repeater&gt;  := REPEAT ( &lt;processor&gt; ) &lt;number&gt; TIMES ;
</pre>

<p>and the contents of <code>associations.txt</code>:</p>

<pre class="code">
&lt;repeater&gt;,my.package.Repeater
</pre>

<p>From then on, you can add this extension to the interpreter by calling:</p>

<pre class="code">
my_int.addExtension(MyExtension.class);
</pre>

							</div>
						</section>
					</div>
				</div>
				
			</div>
		</div>
	</div>
</div>
<div id="footer-wrapper">
	<div class="5grid-layout">
		<div class="row" id="footer-content">
			<div class="3u" id="box1">
				<section>
					<h2>Made at LIF</h2>
					<p><a href="#"><img src="images/logo-shadow.png" alt="LIF"/></a></p>
					<p>&nbsp;</p>
					<p>BeepBeep was developed through the research done at <a href="http://lif.uqac.ca">LIF</a>, the
					Formal Computer Science Laboratory in <a href="http://www.uqac.ca/">Université du Québec à
					Chicoutimi</a>, Canada.</p>
				</section>
			</div>
			<div class="3u" id="box2">
				<section>
					<h2>Around BeepBeep</h2>
					<ul class="style6">
						<li class="first">
							<h3>Meet the author</h3>
							<p><a href="http://leduotang.ca/sylvain">Visit the homepage of Sylvain Hallé, author of BeepBeep and recipient of numerous research awards.</a></p>
						</li>
						<li>
							<h3>Complex Event Processing</h3>
							<p><a href="https://en.wikipedia.org/wiki/Complex_event_processing">Read about CEP on Wikipedia</a></p>
						</li>
						<!--<li>
							<h3>Donec dictum metus in sapien</h3>
							<p><a href="#">Donec leo, vivamus fermentum nibh in augue praesent a lacus at urna congue rutrum.</a></p>
						</li>-->
					</ul>
				</section>
			</div>
			<div class="3u" id="box4">
				<section>
					<h2>Interested in BeepBeep?</h2>
					<p><strong>If you think BeepBeep can be useful to you, please contact us!</strong></p>
					<p>&nbsp;</p>
					<p>BeepBeep is free software, released under the <a href="https://www.gnu.org/copyleft/lesser.html">GNU LGPL</a>. This means you can include it as a library
					in any project, including closed-source commercial software.</p>
					<p>&nbsp;</p>
					<p>Also, if you are interested to contribute new features to the tool, don't hesitate to drop us a line.</p>
				</section>
			</div>
			<div class="3u" id="box3">
				<section>
					<h2>Contact Information</h2>
					<p><strong>Sylvain Hallé, Ph.D.</strong><br/>
					Associate Professor</p>
					<p><strong>Email</strong>: shalle@uqac.ca</p>
					<p>&nbsp;</p>
					<p><strong>Université du Québec à Chicoutimi</strong><br/>
					555, boul. de l'Université<br/>
					Chicoutimi, Québec<br/>
					G7H 2B1 Canada</p>
				</section>
			</div>
		</div>
	</div>
</div>
<div>
	<div class="5grid-layout" id="copyright">
		<div class="row">
			<div class="12u">
				<p>&copy; 2008-2015 Laboratoire d'informatique formelle | Design: <a href="http://html5templates.com/">HTML5Templates.com</a></p>
			</div>
		</div>
	</div>
</div>
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//leduotang.ca/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//leduotang.ca/piwik/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
</body>
</html>